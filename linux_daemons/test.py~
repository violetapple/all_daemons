import asyncio
import re
from asyncio.subprocess import create_subprocess_exec, PIPE


name_and_status = re.compile(' \[ ([+-]) ] ([\w\-.]+) ')
def get_process(commands):
    return create_subprocess_exec(*commands, stdout=PIPE, stderr=PIPE)

async def get_daemons_list():
    try:
        daemons = {}
        command_list = ["sudo", "service", "--status-all"]
        process = await get_process(command_list)
        output, err = await process.communicate()
        lines = bytes(output).decode().split('\n')
        for line in lines:
            if len(line) == 0:
                break
            name = line.split(']  ')[1]
            if '+' in line:
                daemons[name] = '+'
            else:
                daemons[name] = '-'
        print(daemons.keys())
        
        for k in daemons:
            print(k + ' ' + daemons[k])
    except Exception as e:
        print("Exception occured while getting list of daemons")
        print(e)

loop = asyncio.get_event_loop()
try:
    loop.run_until_complete(get_daemons_list())
except Exception as e:
    print(e)

